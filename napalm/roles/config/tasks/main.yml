---
- name: Commit Changes
  ansible.builtin.debug:
    msg: '[WARNING]: COMMIT_CHANGES is TRUE'
  when: commit_changes

- name: Ensure ./configs/{{ inventory_hostname }} dir exists
  ansible.builtin.file:
    path: ./configs/{{ inventory_hostname }}
    state: directory

- name: Render template for {{ inventory_hostname }}
  ansible.builtin.template:
    src: 'baseconf.j2'
    dest: ./configs/{{ inventory_hostname }}/rendered.conf

- name: Load Config, Diff ({{ get_diffs }}), Commit ({{ commit_changes }})
  napalm.napalm.napalm_install_config:
    hostname: '{{ inventory_hostname }}'
    username: '{{ ansible_user }}'
    password: '{{ ansible_password }}'
    dev_os: 'junos'
    config_file: ./configs/{{ inventory_hostname }}/rendered.conf
    commit_changes: '{{ commit_changes }}'
    replace_config: False
    get_diffs: '{{ get_diffs }}'
    diff_file: ./configs/{{ inventory_hostname }}/diff
